import{t as M,_ as V}from"./index.be315e2f.js";import{ah as n,o as c,O as D,P as i,V as t,c as y,F as R,a8 as N,a as g,S,T as v,U as f,ax as Q,ar as P,Q as B,a9 as J}from"./vendor-vue.cefe3aef.js";import{C as X}from"./ConnectStatus.d705aed4.js";import{M as Y}from"./monitor-status-enums.58a9ce3c.js";import{D as Z}from"./DataCount.6ee1e60d.js";import{C as ee,E as te}from"./ExportFileDialog.c701c42b.js";import{u as oe}from"./group-store.f3666cf0.js";import{F as le}from"./vendor-lib.a8c0b8df.js";import{e as q,d as ne}from"./element-plus.af689926.js";import"./element-icon.1fe9d2a8.js";const ie={title:[{message:"\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}],monitor_type:[{message:"\u76D1\u63A7\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}],interval:[{message:"\u68C0\u6D4B\u9891\u7387\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}],allow_error_count:[{message:"\u91CD\u8BD5\u6B21\u6570\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}]},T={UNKNOWN:0,HTTP:1},O=[{value:T.HTTP,label:M("HTTP")}],ae=[{value:T.UNKNOWN,label:M("\u672A\u77E5")},...O];function re(o){var e;return(e=ae.find(l=>l.value==o))==null?void 0:e.label}const se={GET:"GET",POST:"POST"},U=[{value:se.GET,label:M("GET")}],ue={url:[{message:"URL\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}],method:[{message:"\u8BF7\u6C42\u65B9\u5F0F\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}],timeout:[{message:"\u8D85\u65F6\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}]},de={name:"",props:{form:{type:Object,default:null}},components:{},data(){return{rules:ue,MonitorTypeEnum:T,MonitorTypeOptions:O,RequestMethodOptions:U}},computed:{},methods:{handleSubmit(){console.log("handleSubmit"),this.$refs.form.validate(o=>{if(console.log(o),o)this.confirmSubmit();else return!1})},confirmSubmit(){console.debug("confirmSubmit",this.form),this.$emit("on-confirm",this.form)}},created(){}},ce=g("span",{class:"ml-sm color--info"},"\uFF08\u79D2\uFF09",-1);function me(o,e,l,h,a,r){const u=n("el-option"),d=n("el-select"),_=n("el-form-item"),C=n("el-input"),x=n("el-form");return c(),D(x,{ref:"form",model:l.form,rules:a.rules,"label-width":"100px"},{default:i(()=>[t(_,{label:"\u8BF7\u6C42\u65B9\u5F0F",prop:"method"},{default:i(()=>[t(d,{modelValue:l.form.method,"onUpdate:modelValue":e[0]||(e[0]=m=>l.form.method=m),style:{width:"140px"},disabled:""},{default:i(()=>[(c(!0),y(R,null,N(a.RequestMethodOptions,m=>(c(),D(u,{key:m.value,label:m.label,value:m.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(_,{label:"\u8BF7\u6C42URL",prop:"url"},{default:i(()=>[t(C,{type:"text",modelValue:l.form.url,"onUpdate:modelValue":e[1]||(e[1]=m=>l.form.url=m),placeholder:"\u8BF7\u8F93\u5165\u8BF7\u6C42URL"},null,8,["modelValue"])]),_:1}),t(_,{label:"\u8BF7\u6C42\u8D85\u65F6",prop:"timeout"},{default:i(()=>[t(C,{style:{width:"140px"},type:"number",modelValue:l.form.timeout,"onUpdate:modelValue":e[2]||(e[2]=m=>l.form.timeout=m),placeholder:"\u8BF7\u8F93\u5165\u8D85\u65F6\u65F6\u95F4"},null,8,["modelValue"]),ce]),_:1})]),_:1},8,["model","rules"])}const pe=V(de,[["render",me]]),_e={name:"",props:{row:{type:Object,default:null}},components:{HttpDataForm:pe},data(){return{rules:ie,MonitorTypeEnum:T,MonitorTypeOptions:O,RequestMethodOptions:U,form:{title:"",monitor_type:O[0].value,content:{method:U[0].value,url:"",timeout:3},interval:"60",status:"",is_active:!0,next_run_time:"",allow_error_count:"0"}}},computed:{},methods:{async getData(){if(this.row){let o={monitor_id:this.row.id};const e=await this.$http.getMonitorById(o);if(e.code!=0)return;let l=e.data;this.form.title=l.title,this.form.monitor_type=l.monitor_type,this.form.content=l.content,this.form.interval=l.interval,this.form.allow_error_count=l.allow_error_count}},handleCancel(){this.$emit("on-cancel")},handleSubmit(){this.$refs.MonitorDataForm.handleSubmit()},handleMonitorDataFormConfirm(){this.$refs.form.validate(o=>{if(o)this.confirmSubmit();else return!1})},async confirmSubmit(){console.log("handleMonitorDataFormConfirm");let o=this.$loading({fullscreen:!0}),e={title:this.form.title,monitor_type:this.form.monitor_type,content:this.form.content,interval:this.form.interval,allow_error_count:this.form.allow_error_count},l=null;this.row&&this.row.id?l=await this.$http.updateMonitorById({...e,monitor_id:this.row.id}):l=await this.$http.addMonitor(e),l.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(l.msg),this.$nextTick(()=>{o.close()})}},created(){this.getData()}},he=g("span",{class:"color--info ml-sm"},"\uFF08\u5206\u949F\uFF09",-1),fe={class:"text-center"};function ge(o,e,l,h,a,r){const u=n("el-input"),d=n("el-form-item"),_=n("el-option"),C=n("el-select"),x=n("HttpDataForm"),m=n("el-form"),k=n("el-button");return c(),y("div",null,[t(m,{ref:"form",model:a.form,rules:a.rules,"label-width":"100px"},{default:i(()=>[t(d,{label:"\u540D\u79F0",prop:"title"},{default:i(()=>[t(u,{type:"text",modelValue:a.form.title,"onUpdate:modelValue":e[0]||(e[0]=p=>a.form.title=p),placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0"},null,8,["modelValue"])]),_:1}),t(d,{label:"\u76D1\u63A7\u7C7B\u578B",prop:"monitor_type"},{default:i(()=>[t(C,{modelValue:a.form.monitor_type,"onUpdate:modelValue":e[1]||(e[1]=p=>a.form.monitor_type=p),style:{width:"140px"},disabled:""},{default:i(()=>[(c(!0),y(R,null,N(a.MonitorTypeOptions,p=>(c(),D(_,{key:p.value,label:p.label,value:p.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a.MonitorTypeEnum.HTTP==a.form.monitor_type?(c(),D(x,{key:0,ref:"MonitorDataForm",form:a.form.content,onOnConfirm:r.handleMonitorDataFormConfirm},null,8,["form","onOnConfirm"])):S("",!0),t(d,{label:"\u68C0\u6D4B\u9891\u7387",prop:"interval"},{default:i(()=>[t(u,{style:{width:"140px"},type:"number",modelValue:a.form.interval,"onUpdate:modelValue":e[2]||(e[2]=p=>a.form.interval=p),placeholder:"\u8BF7\u8F93\u5165\u68C0\u6D4B\u9891\u7387"},null,8,["modelValue"]),he]),_:1}),t(d,{label:"\u91CD\u8BD5\u6B21\u6570",prop:"allow_error_count"},{default:i(()=>[t(u,{style:{width:"140px"},type:"number",modelValue:a.form.allow_error_count,"onUpdate:modelValue":e[3]||(e[3]=p=>a.form.allow_error_count=p),placeholder:"\u8BF7\u8F93\u5165\u91CD\u8BD5\u6B21\u6570"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),g("div",fe,[t(k,{onClick:r.handleCancel},{default:i(()=>[v(f(o.$t("\u53D6\u6D88")),1)]),_:1},8,["onClick"]),t(k,{type:"primary",onClick:r.handleSubmit},{default:i(()=>[v(f(o.$t("\u786E\u5B9A")),1)]),_:1},8,["onClick"])])])}const be=V(_e,[["render",ge]]),we={name:"",props:{row:{type:Object,default:null},visible:{type:Boolean,default:!1}},emits:["update:visible"],components:{DataForm:be},data(){return{}},computed:{dialogTitle(){return this.row?"\u7F16\u8F91":"\u6DFB\u52A0"},dialogVisible:{get(){return this.visible},set(o){this.$emit("update:visible",o)}}},methods:{handleClose(){this.$emit("update:visible",!1)},handleOpen(){this.$emit("update:visible",!0)},handleSuccess(){this.handleClose(),this.$emit("on-success")}},created(){}};function ye(o,e,l,h,a,r){const u=n("DataForm"),d=n("el-dialog");return c(),D(d,{title:r.dialogTitle,modelValue:r.dialogVisible,"onUpdate:modelValue":e[0]||(e[0]=_=>r.dialogVisible=_),width:"600px",center:"","append-to-body":""},{default:i(()=>[r.dialogVisible?(c(),D(u,{key:0,row:l.row,onOnCancel:r.handleClose,onOnSuccess:r.handleSuccess},null,8,["row","onOnCancel","onOnSuccess"])):S("",!0)]),_:1},8,["title","modelValue"])}const $=V(we,[["render",ye]]),Ce={name:"",components:{DataFormDialog:$,ConnectStatus:X},props:{list:{type:Array}},computed:{},data(){return{currentRow:null,dialogVisible:!1}},methods:{handleEditRow(o){this.currentRow=o,this.dialogVisible=!0},async handleDeleteClick(o){let e={monitor_id:o.id};const l=await this.$http.removeMonitorById(e);l.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(l.msg)},async handleStatusChange(o,e){let l={monitor_id:o.id,is_active:e};const h=await this.$http.updateMonitorActive(l);h.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(h.msg)},handleUpdateSuccess(){this.$emit("on-success")},handleOpenLogClick(o){let e=this.$router.resolve({name:"log-monitor-list",query:{monitorId:o.id}});window.open(e.href,"_blank")}},created(){}},ve={key:1};function De(o,e,l,h,a,r){const u=n("el-table-column"),d=n("ConnectStatus"),_=n("el-link"),C=n("el-switch"),x=n("Edit"),m=n("el-icon"),k=n("Delete"),p=n("el-popconfirm"),F=n("el-table"),E=n("DataFormDialog");return c(),y("div",null,[t(F,{data:l.list,stripe:"",border:""},{default:i(()=>[t(u,{label:"\u540D\u79F0","header-align":"center",align:"center",prop:"title"},{default:i(s=>[g("span",null,f(s.row.title||"-"),1)]),_:1}),t(u,{label:"\u76D1\u63A7\u7C7B\u578B","header-align":"center",align:"center",prop:"monitor_type",width:"100"},{default:i(s=>[g("span",null,f(s.row.monitor_type_label||"-"),1)]),_:1}),t(u,{label:"\u9891\u7387(\u5206\u949F)","header-align":"center",align:"center",prop:"interval",width:"100"},{default:i(s=>[g("span",null,f(s.row.interval||"-"),1)]),_:1}),t(u,{label:"\u72B6\u6001","header-align":"center",align:"center",prop:"status",width:"100"},{default:i(s=>[t(d,{value:s.row.status_value,onOnClick:b=>r.handleOpenLogClick(s.row)},null,8,["value","onOnClick"])]),_:1}),t(u,{label:"\u65E5\u5FD7","header-align":"center",align:"center",prop:"interval",width:"100"},{default:i(s=>[s.row.log_count&&s.row.log_count>0?(c(),D(_,{key:0,underline:!1,onClick:b=>r.handleOpenLogClick(s.row)},{default:i(()=>[v(f(s.row.log_count),1)]),_:2},1032,["onClick"])):(c(),y("span",ve,"-"))]),_:1}),t(u,{label:"\u4E0B\u6B21\u8FD0\u884C\u65F6\u95F4","header-align":"center",align:"center",prop:"next_run_time",width:"180"},{default:i(s=>[g("span",null,f(s.row.next_run_time||"-"),1)]),_:1}),t(u,{label:"\u542F\u7528","header-align":"center",align:"center",width:"80"},{default:i(s=>[t(C,{modelValue:s.row.is_active,"onUpdate:modelValue":b=>s.row.is_active=b,onChange:b=>r.handleStatusChange(s.row,b)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(u,{label:"\u7F16\u8F91",width:"60","header-align":"center",align:"center"},{default:i(s=>[t(_,{underline:!1,type:"primary",onClick:b=>r.handleEditRow(s.row)},{default:i(()=>[t(m,null,{default:i(()=>[t(x)]),_:1})]),_:2},1032,["onClick"])]),_:1}),t(u,{label:"\u5220\u9664",width:"60",align:"center",prop:"tag"},{default:i(s=>[t(p,{title:`${o.$t("\u786E\u5B9A\u5220\u9664")}\uFF1F`,onConfirm:b=>r.handleDeleteClick(s.row)},{reference:i(()=>[t(_,{underline:!1,type:"danger"},{default:i(()=>[t(m,null,{default:i(()=>[t(k)]),_:1})]),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),t(E,{visible:a.dialogVisible,"onUpdate:visible":e[0]||(e[0]=s=>a.dialogVisible=s),row:a.currentRow,onOnSuccess:r.handleUpdateSuccess},null,8,["visible","row","onOnSuccess"])])}const xe=V(Ce,[["render",De]]),ke={name:"ConditionFilter",props:{},components:{ConditionFilterGroup:ee},data(){return{loading:!0,options:[{title:"\u7F51\u7AD9\u72B6\u6001",field:"status",selected:[],maxCount:1,options:[{label:"\u8FDE\u63A5\u5F02\u5E38",value:2},{label:"\u8FDE\u63A5\u6B63\u5E38",value:1},{label:"\u72B6\u6001\u672A\u77E5",value:0}]}]}},computed:{...Q(oe,{groupOptions:"getGroupOptions"})},methods:{async resetData(){const o=await this.$http.getGroupList();o.ok&&this.options.forEach(e=>{e.field=="group_ids"&&(o.data.list&&o.data.list.length>0?(e.options=o.data.list.map(l=>{let h=l.name;return{...l,value:l.id,label:h}}),e.hidden=!1):e.hidden=!0)}),this.loading=!1},handleChange(o){this.$emit("on-change",this.options)}},created(){this.loading=!1}},Fe={class:""};function Ve(o,e,l,h,a,r){const u=n("ConditionFilterGroup"),d=P("loading");return B((c(),y("div",Fe,[t(u,{options:a.options,onOnChange:r.handleChange},null,8,["options","onOnChange"])])),[[d,a.loading]])}const Se=V(ke,[["render",Ve]]),Oe={name:"monitor-list",props:{},components:{DataFormDialog:$,DataTable:xe,DataCount:Z,ConditionFilter:Se,ExportFileDialog:te},data(){return{list:[],total:0,page:1,size:20,keyword:"",loading:!0,hasInitData:!0,dialogVisible:!1,params:{},ConditionFilterParams:[],exportFileDialogVisible:!1,next_run_time:null}},computed:{},methods:{resetData(){this.page=1,this.getMonitorTaskNextRunTime(),this.getData()},async getMonitorTaskNextRunTime(){const o=await this.$http.getMonitorTaskNextRunTime();if(this.next_run_time=o.data.next_run_time,this.next_run_time){let e=q(this.next_run_time).diff(q());e>0&&setTimeout(()=>{this.getMonitorTaskNextRunTime(),this.getData()},e)}},async getData(){this.loading=!0;let o={page:this.page,size:this.size,keyword:this.keyword};for(let e of this.ConditionFilterParams)e.selected&&e.selected.length>0&&(e.maxCount==1?o[e.field]=e.selected[0]:o[e.field]=e.selected);this.params=o;try{const e=await this.$http.getMonitorList(o);e.code==0&&(this.list=e.data.list.map(l=>(l.monitor_type_label=re(l.monitor_type),l.status_value=Y(l.status),l)),this.total=e.data.total)}catch(e){console.log(e)}finally{this.loading=!1}},handleAddRow(){this.dialogVisible=!0},handleAddSuccess(){this.resetData()},handleSearch(){this.resetData()},handleConditionFilterChange(o){console.log(o),this.ConditionFilterParams=o,this.resetData()},handleExportToFile(){this.exportFileDialogVisible=!0},async handleExportConfirm(o){const e=await this.$http.exportMonitorFile({...this.params,ext:o.ext});e.ok&&le.saveAs(e.data.url,e.data.name)},handleExceed(o){this.$refs.upload.clearFiles();const e=o[0];e.uid=ne(),this.handleHttpRequest({file:e})},async handleHttpRequest(o){let e=this.$loading({fullscreen:!0}),l=new FormData;l.append("file",o.file),(await this.$http.importMonitorFromFile(l)).code==0&&(this.$msg.success("\u5BFC\u5165\u6210\u529F\uFF0C\u540E\u53F0\u68C0\u6D4B\u4E2D"),this.resetData(),this.$refs.ConditionFilter&&this.$refs.ConditionFilter.resetData()),e.close()}},created(){this.resetData()}},Te={class:"app-container"},Ee={class:"flex justify-between"},Ue={class:"flex mt-sm",style:{"align-items":"center"}},Me={class:"flex",style:{"margin-left":"auto"}},Re={key:0,class:"color--info text-sm"},qe=g("div",{style:{position:"absolute",top:"0",left:"0",right:"0",bottom:"0"}},null,-1);function Ne(o,e,l,h,a,r){const u=n("Plus"),d=n("el-icon"),_=n("el-button"),C=n("Search"),x=n("el-input"),m=n("ConditionFilter"),k=n("DataCount"),p=n("Delete"),F=n("el-link"),E=n("el-popconfirm"),s=n("Edit"),b=n("UpdateDomainInfo"),G=n("CheckDomainInfo"),H=n("Upload"),I=n("el-upload"),L=n("Download"),z=n("DataTable"),A=n("el-pagination"),j=n("DataFormDialog"),K=n("ExportFileDialog"),W=P("loading");return c(),y("div",Te,[g("div",Ee,[t(_,{type:"primary",onClick:r.handleAddRow},{default:i(()=>[t(d,null,{default:i(()=>[t(u)]),_:1}),v(f(o.$t("\u6DFB\u52A0")),1)]),_:1},8,["onClick"]),t(x,{class:"ml-sm",style:{width:"260px"},modelValue:a.keyword,"onUpdate:modelValue":e[0]||(e[0]=w=>a.keyword=w),placeholder:"\u8F93\u5165\u540D\u79F0",clearable:"",onKeypress:J(r.handleSearch,["enter"]),onClear:r.handleSearch},{append:i(()=>[t(_,{onClick:r.handleSearch},{default:i(()=>[t(d,null,{default:i(()=>[t(C)]),_:1})]),_:1},8,["onClick"])]),_:1},8,["modelValue","onKeypress","onClear"])]),a.hasInitData?(c(),D(m,{key:0,class:"mt-md",ref:"ConditionFilter",onOnChange:r.handleConditionFilterChange},null,8,["onOnChange"])):S("",!0),g("div",Ue,[t(k,{value:a.total},null,8,["value"]),g("div",Me,[a.next_run_time?(c(),y("span",Re,"\u5373\u5C06\u8FD0\u884C\uFF1A"+f(a.next_run_time),1)):S("",!0),o.showBatchActionButton?(c(),y(R,{key:1},[t(E,{title:"\u786E\u5B9A\u5220\u9664\u9009\u4E2D\uFF1F",onConfirm:o.handleBatchDeleteConfirm},{reference:i(()=>[t(F,{underline:!1,type:"danger",class:"mr-sm"},{default:i(()=>[t(d,null,{default:i(()=>[t(p)]),_:1}),v("\u6279\u91CF\u5220\u9664")]),_:1})]),_:1},8,["onConfirm"]),t(F,{underline:!1,type:"primary",class:"mr-sm",onClick:o.handleShowBatchUpdateDialog},{default:i(()=>[t(d,null,{default:i(()=>[t(s)]),_:1}),v("\u6279\u91CF\u64CD\u4F5C")]),_:1},8,["onClick"])],64)):S("",!0),t(b,{onOnSuccess:r.resetData},null,8,["onOnSuccess"]),t(G,{class:"ml-sm",onOnSuccess:r.resetData},null,8,["onOnSuccess"]),t(F,{underline:!1,type:"primary",class:"ml-sm",style:{position:"relative"}},{default:i(()=>[t(d,null,{default:i(()=>[t(H)]),_:1}),v(f(o.$t("\u5BFC\u5165"))+" ",1),t(I,{ref:"upload",action:"action",accept:".txt,.csv,.xlsx",limit:1,"on-exceed":r.handleExceed,"show-file-list":!1,"http-request":r.handleHttpRequest},{default:i(()=>[qe]),_:1},8,["on-exceed","http-request"])]),_:1}),t(F,{underline:!1,type:"primary",class:"ml-sm",onClick:r.handleExportToFile},{default:i(()=>[t(d,null,{default:i(()=>[t(L)]),_:1}),v(f(o.$t("\u5BFC\u51FA")),1)]),_:1},8,["onClick"])])]),B(t(z,{class:"mt-sm",list:a.list,onOnSuccess:r.resetData,onOnEditRow:o.handleEditRow},null,8,["list","onOnSuccess","onOnEditRow"]),[[W,a.loading]]),t(A,{class:"mt-md justify-center",background:"",layout:"total, prev, pager, next",total:a.total,"page-size":a.size,"onUpdate:pageSize":e[1]||(e[1]=w=>a.size=w),"current-page":a.page,"onUpdate:currentPage":e[2]||(e[2]=w=>a.page=w),onCurrentChange:r.getData},null,8,["total","page-size","current-page","onCurrentChange"]),t(j,{visible:a.dialogVisible,"onUpdate:visible":e[3]||(e[3]=w=>a.dialogVisible=w),onOnSuccess:r.handleAddSuccess},null,8,["visible","onOnSuccess"]),t(K,{allowExts:["xlsx","csv"],visible:a.exportFileDialogVisible,"onUpdate:visible":e[4]||(e[4]=w=>a.exportFileDialogVisible=w),onOnConfirm:r.handleExportConfirm},null,8,["visible","onOnConfirm"])])}const Ke=V(Oe,[["render",Ne]]);export{Ke as default};
