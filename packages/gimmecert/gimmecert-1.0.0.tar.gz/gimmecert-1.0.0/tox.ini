#
# Copyright (C) 2018, 2020, 2024 Branko Majic
#
# This file is part of Gimmecert.
#
# Gimmecert is free software: you can redistribute it and/or modify it
# under the terms of the GNU General Public License as published by the Free
# Software Foundation, either version 3 of the License, or (at your option) any
# later version.
#
# Gimmecert is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more
# details.
#
# You should have received a copy of the GNU General Public License along with
# Gimmecert.  If not, see <http://www.gnu.org/licenses/>.
#

[tox]
envlist = {py38,py39,py310,py311,py312},lint,doc

[testenv]
allowlist_externals =
  make

basepython =
  doc: python3
  lint: python3
  py38: python3.8
  py39: python3.9
  py310: python3.10
  py311: python3.11
  py312: python3.12

deps =
  .[test]

setenv =
  # Force column width for functional tests since they depend on
  # predictable output format.
  COLUMNS=80

commands =
  # Must specify cov-report explicitly, otherwise coverage starts
  # going through the tests as well.
  pytest --cov --cov-report=term-missing:skip-covered --basetemp={envtmpdir} tests/ functional_tests/

[testenv:lint]
deps =
  .[testlint]
commands =
  flake8

[testenv:doc]
deps =
  .[doc]
setenv =
  # Override Sphinx build directory so we do not trample over user's
  # build in source directory.
  BUILDDIR={envtmpdir}/docs_build
commands =
  # Easier to run than changing directory with separate comand. -e
  # will ensure the BUILDDIR gets picked-up and overrides the Makefile
  # content.
  make -C docs/ -e html
