import{C as Z,_ as ee}from"./ChatRecprdsHeader-5Ou4NLV2.js";import{d as H,r as n,a as te,o as P,h as F,b as U,c as a,e as u,f as t,t as V,g as o,w as M,i as D,_ as K,j as Y,k as R,F as le,l as ae,m as S,M as ne,n as oe,p as se,q as ie,s as re,u as ce,v as A,x as E,E as B,y as de,z as N,A as q,B as ue,C as _e}from"./index-ti87wIWN.js";import{_ as he}from"./HomeView.vue_vue_type_script_setup_true_lang-Acijt9qS.js";const pe={class:"chat-content"},ve={key:0,class:"word"},fe=["src"],ye={class:"info"},me={class:"time"},ge={style:{float:"left"}},we=["href"],xe={key:1,class:"word-my"},be={class:"info"},ke={class:"time"},$e={style:{float:"right"}},Ue=["href"],Me=["src"],Ve=H({__name:"MessageFile",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(y){const f=y,c=n(""),l=te({file_name:String,file_size:Number,file_size_unit:String});P(async()=>{console.log("文件加载中");const p=await h(f.src);console.log(p),l.file_name=p.file_name,l.file_size=Number(p.file_size)/1024,l.file_size<1024?l.file_size_unit="kb":(l.file_size=l.file_size/1024,l.file_size_unit="mb"),l.file_size=Number(p.file_size)/1024,c.value=`/api/file/${f.src}`});const h=async p=>{try{return await F.post("/api/file_info",{file_path:p})}catch(w){return console.error("Error fetching file_info:",w),""}};return(p,w)=>{const i=U("el-card");return a(),u("div",pe,[y.is_sender?(a(),u("div",xe,[t("div",be,[t("p",ke,V(y.direction),1),t("div",$e,[o(i,{shadow:"hover",style:{width:"fit-content"}},{default:M(()=>[D("文件 ： "),t("a",{href:c.value,download:""},V(l.file_name),9,Ue),t("div",null,[D(" 文件大小："),t("span",null,V(l.file_size)+V(l.file_size_unit),1)])]),_:1})])]),t("img",{src:y.headUrl},null,8,Me)])):(a(),u("div",ve,[t("img",{src:y.headUrl},null,8,fe),t("div",ye,[t("p",me,V(y.direction),1),t("div",ge,[o(i,{shadow:"hover",style:{width:"fit-content"}},{default:M(()=>[D("文件 ： "),t("a",{href:c.value,download:""},V(l.file_name),9,we),t("div",null,[D(" 文件大小："),t("span",null,V(l.file_size)+V(l.file_size_unit),1)])]),_:1})])])]))])}}}),Se=K(Ve,[["__scopeId","data-v-9dc49946"]]),De={id:"chat"},Te={class:"chat_body"},Ce={class:"chat_window",ref:"chatWindow"},ze={key:0,class:"load_more",style:{display:"flex","justify-content":"center","margin-top":"10px","margin-bottom":"10px"}},je=H({__name:"ChatRecordsMain",props:{userData:{type:Object,required:!0},setScrollTop:{type:Function,required:!0},updateScrollTop:{type:Function,required:!0}},setup(y,{expose:f}){const c=y,l=n([]),h=n({}),p=n(""),w=n(50),i=n(0),x=n(!1),T=async(r,k,d)=>{try{const e=await F.post("/api/msgs",{start:r,limit:k,wxid:d});return l.value=e.msg_list,h.value=e.user_list,p.value=e.my_wxid,e}catch(e){return console.error("Error fetching data:",e),[]}},C=async()=>{try{i.value=c.userData.chat_count-w.value,await T(i.value,w.value,c.userData.username),x.value||await A(()=>{c.setScrollTop(),x.value=!1})}catch(r){return console.error("Error fetching data:",r),[]}};P(C),Y(()=>c.userData.username,(r,k)=>{console.log("username changed",r,k),l.value=[],x.value=!1,C()});const b=r=>(r.talker=="我"&&(r.talker=p.value),`${(d=>h.value.hasOwnProperty(d.talker)?h.value[d.talker].remark?h.value[d.talker].remark:h.value[d.talker].nickname?h.value[d.talker].nickname:h.value[d.talker].account?h.value[d.talker].account:d.talker:d.talker)(r)} [${r.type_name}] ${r.CreateTime}`),v=r=>(r.talker=="我"&&(r.talker=p.value),h.value.hasOwnProperty(r.talker)?h.value[r.talker].headImgUrl:""),z=async()=>{let r=w.value,k=i.value-r;const d=await F.post("/api/msgs",{start:k,limit:r,wxid:c.userData.username});i.value=k,l.value=d.msg_list.concat(l.value),l.value.sort((e,$)=>e.id-$.id),l.value=l.value.filter((e,$,m)=>$===0||e.id!==m[$-1].id),h.value=Object.assign(h.value,d.user_list),await A(()=>{c.updateScrollTop()})};return f({loadMore:z}),(r,k)=>{const d=U("el-button");return a(),u("div",De,[t("div",Te,[t("div",Ce,[l.value.length<y.userData.chat_count?(a(),u("div",ze,[o(d,{type:"primary",onClick:z},{default:M(()=>[D("查看更多消息")]),_:1})])):R("",!0),(a(!0),u(le,null,ae(l.value,(e,$)=>(a(),u("div",{class:"message",key:$},[e.type_name=="文本"?(a(),S(ne,{key:0,is_sender:e.is_sender,direction:b(e),headUrl:v(e),content:e.content.msg},null,8,["is_sender","direction","headUrl","content"])):e.type_name=="图片"?(a(),S(oe,{key:1,is_sender:e.is_sender,direction:b(e),headUrl:v(e),src:"/api/img?img_path="+e.content.src},null,8,["is_sender","direction","headUrl","src"])):e.type_name=="动画表情"?(a(),S(se,{key:2,is_sender:e.is_sender,direction:b(e),headUrl:v(e),src:e.content.src},null,8,["is_sender","direction","headUrl","src"])):e.type_name=="视频"?(a(),S(ie,{key:3,is_sender:e.is_sender,direction:b(e),headUrl:v(e),src:e.content.src},null,8,["is_sender","direction","headUrl","src"])):e.type_name=="文件"?(a(),S(Se,{key:4,is_sender:e.is_sender,direction:b(e),headUrl:v(e),src:e.content.src},null,8,["is_sender","direction","headUrl","src"])):e.type_name=="语音"?(a(),S(re,{key:5,is_sender:e.is_sender,direction:b(e),headUrl:v(e),src:"/api/"+e.content.src,msg:e.content.msg},null,8,["is_sender","direction","headUrl","src","msg"])):(a(),S(ce,{key:6,is_sender:e.is_sender,direction:b(e),headUrl:v(e),content:e.content.msg},null,8,["is_sender","direction","headUrl","content"]))]))),128))],512)])])}}}),Ee=K(je,[["__scopeId","data-v-c286032e"]]),Re=H({__name:"ChatRecords",props:{userData:{type:Object,required:!0}},setup(y){const f=n(null),c=n(null);n(0);const l=n(0),h=()=>{A(()=>{if(f.value){const i=f.value.$el.children[0];i&&(i.scrollTop=i.scrollHeight,l.value=i.scrollHeight)}})},p=()=>{const i=f.value.$el.children[0];if(i){const x=l.value,T=i.scrollHeight-x;i.scrollTop=i.scrollTop+T,l.value=i.scrollHeight}};function w({scrollTop:i}){i===0&&c.value&&c.value.loadMore()}return(i,x)=>{const T=U("el-header"),C=U("el-scrollbar"),b=U("el-main"),v=U("el-container");return a(),S(v,null,{default:M(()=>[o(T,{style:{height:"65px","max-height":"65px",width:"100%","background-color":"#d2d2fa","padding-top":"5px"}},{default:M(()=>[o(Z,{userData:y.userData},null,8,["userData"])]),_:1}),o(b,{style:{"overflow-y":"auto",height:"calc(100vh - 65px)",padding:"0"}},{default:M(()=>[o(C,{ref_key:"scrollbarRef",ref:f,onScroll:w},{default:M(()=>[o(Ee,{ref_key:"chatRecordsMainRef",ref:c,userData:y.userData,setScrollTop:h,updateScrollTop:p},null,8,["userData"])]),_:1},512)]),_:1})]),_:1})}}}),Be={style:{"background-color":"#d2d2fa",height:"100vh",display:"flex","justify-content":"center","align-items":"center"}},Ne={key:0},qe={key:1,style:{"background-color":"#fff",width:"90%","min-width":"800px",height:"80%","border-radius":"10px",padding:"20px",overflow:"auto"}},Fe=t("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[t("div",{style:{"font-size":"20px","font-weight":"bold"}},"选择要查看的微信")],-1),He={style:{"margin-top":"20px"}},Ie={style:{"margin-top":"20px"}},Ae={key:1},Oe={style:{"background-color":"#fff",width:"80%","min-width":"800px",height:"70%","border-radius":"10px",padding:"20px",overflow:"auto"}},We=t("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[t("div",{style:{"font-size":"20px","font-weight":"bold"}},"自定义-文件位置"),t("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}})],-1),Ge={style:{"margin-top":"20px"}},Pe={key:0},Ke=t("label",null,"MicroMsg.db 路径: ",-1),Ye=t("br",null,null,-1),Le={key:1},Je=t("label",null,"MSG.db 路径: ",-1),Qe=t("br",null,null,-1),Xe={key:2},Ze=t("label",null,"MediaMSG.db 路径: ",-1),et=t("br",null,null,-1),tt=t("label",null,"微信文件夹路径: ",-1),lt=t("br",null,null,-1),at=t("label",null,"微信原始id: ",-1),nt=t("br",null,null,-1),ot={key:3},st=t("label",null,"密钥key(可空): ",-1),it=t("br",null,null,-1),rt={key:2},ct={key:3,style:{display:"flex","justify-content":"space-between"}},dt={style:{width:"200px",height:"150px","background-color":"#fff",display:"flex","flex-direction":"column","align-items":"center","border-radius":"10px","margin-right":"20px"}},ut=t("div",{style:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center",height:"100%"}},[t("div",null,"使用上次数据")],-1),_t={style:{width:"200px",height:"150px","background-color":"#fff",display:"flex","flex-direction":"column","align-items":"center","border-radius":"10px","margin-right":"20px"}},ht=t("div",{style:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center",height:"100%"}},[t("div",null,"自动解密已登录微信")],-1),pt={style:{width:"200px",height:"150px","background-color":"#fff",display:"flex","flex-direction":"column","align-items":"center","border-radius":"10px"}},vt=t("div",{style:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center",height:"100%"}},[t("div",null,"自定义文件位置")],-1),ft=H({__name:"IsAutoShow",emits:["isAutoShow"],setup(y,{emit:f}){const c=n(0),l=n(500),h=[{color:"#f56c6c",percentage:20},{color:"#e6a23c",percentage:40},{color:"#5cb87a",percentage:60},{color:"#1989fa",percentage:80},{color:"#6f7ad3",percentage:100}],p=n(new Date().getTime()),w=()=>{b.value||(p.value=new Date().getTime(),!(c.value>=99)&&(c.value>=80&&(l.value=l.value+50),c.value=c.value+1,setTimeout(w,l.value)))},i=n(!1),x=n([]),T=n(""),C=n(!1);n("");const b=n(!1),v=n("false"),z=n(""),r=n(""),k=n(""),d=n(""),e=n(""),$=n(""),m=n(""),L=f,J=async()=>{try{x.value=await F.post("/api/wxinfo"),x.value.length===1&&(O(x.value[0]),T.value=" (检测到只有一个微信，将在5秒后自动选择) ",setTimeout(W,5e3))}catch(g){return console.error("Error fetching data:",g),[]}},O=async g=>{z.value="",r.value="",k.value="",d.value=g.filePath,e.value=g.key,$.value=g.wxid},W=()=>{d.value===""&&e.value===""&&$.value===""||C.value||(console.log(d.value,e.value,$.value),C.value=!0,I(),w())},I=async()=>{try{let g={msg_path:z.value,micro_path:r.value,media_path:k.value,wx_path:d.value,key:e.value,my_wxid:$.value,init_type:m.value};const s=await F.post("/api/init",g);i.value=s.is_init,s.is_init&&(c.value=100),L("isAutoShow",s.is_init)}catch(g){return c.value=0,b.value=!0,ue.alert(g,"error",{confirmButtonText:"确认",callback:s=>{_e({type:"error",message:`action: ${s}`})}}),[]}};return Y(m,g=>{g==="auto"?J():g==="custom"||g==="last"&&I()}),(g,s)=>{const Q=U("el-progress"),G=U("el-button"),X=U("el-divider"),j=U("el-input");return a(),u("div",Be,[m.value==="auto"?(a(),u("div",Ne,[C.value&&!b.value?(a(),S(Q,{key:0,type:"dashboard",percentage:c.value,color:h},null,8,["percentage"])):(a(),u("div",qe,[Fe,t("div",He,[o(E(de),{data:x.value,onCurrentChange:O,"highlight-current-row":"",style:{width:"100%"}},{default:M(()=>[o(E(B),{"min-width":30,prop:"pid",label:"进程id"}),o(E(B),{"min-width":40,prop:"version",label:"微信版本"}),o(E(B),{"min-width":40,prop:"account",label:"账号"}),o(E(B),{"min-width":40,prop:"name",label:"昵称"}),o(E(B),{"min-width":50,prop:"wxid",label:"微信原始id"})]),_:1},8,["data"])]),t("div",Ie,[o(G,{style:{"margin-right":"10px","margin-top":"10px",width:"100%"},type:"success",onClick:W},{default:M(()=>[D("确定"+V(T.value),1)]),_:1})])]))])):m.value==="custom"?(a(),u("div",Ae,[t("div",Oe,[We,t("div",Ge,[N(t("input",{type:"radio","onUpdate:modelValue":s[0]||(s[0]=_=>v.value=_),value:"true"},null,512),[[q,v.value]]),D(" 使用 KEY [自动根据key解密微信文件夹下的数据库]          "),N(t("input",{type:"radio","onUpdate:modelValue":s[1]||(s[1]=_=>v.value=_),value:"false"},null,512),[[q,v.value]]),D(" 不使用 KEY [表示数据库已解密] "),o(X),v.value=="false"?(a(),u("div",Pe,[Ke,o(j,{placeholder:"MicroMsg.db",modelValue:r.value,"onUpdate:modelValue":s[2]||(s[2]=_=>r.value=_),style:{width:"80%"}},null,8,["modelValue"]),Ye])):R("",!0),v.value=="false"?(a(),u("div",Le,[Je,o(j,{placeholder:"MSG.db",modelValue:z.value,"onUpdate:modelValue":s[3]||(s[3]=_=>z.value=_),style:{width:"80%"}},null,8,["modelValue"]),Qe])):R("",!0),v.value=="false"?(a(),u("div",Xe,[Ze,o(j,{placeholder:"MediaMSG.db",modelValue:k.value,"onUpdate:modelValue":s[4]||(s[4]=_=>k.value=_),style:{width:"80%"}},null,8,["modelValue"]),et])):R("",!0),tt,o(j,{placeholder:"C:\\***\\WeChat Files\\wxid_*******",modelValue:d.value,"onUpdate:modelValue":s[5]||(s[5]=_=>d.value=_),style:{width:"80%"}},null,8,["modelValue"]),lt,at,o(j,{placeholder:"wxid_*******",modelValue:$.value,"onUpdate:modelValue":s[6]||(s[6]=_=>$.value=_),style:{width:"80%"}},null,8,["modelValue"]),nt,v.value=="true"?(a(),u("div",ot,[st,o(j,{placeholder:"密钥key (64位)",modelValue:e.value,"onUpdate:modelValue":s[7]||(s[7]=_=>e.value=_),style:{width:"80%"}},null,8,["modelValue"]),it])):R("",!0),o(G,{style:{"margin-top":"10px",width:"100%"},type:"success",onClick:I},{default:M(()=>[D("确定")]),_:1})])])])):m.value==="last"?(a(),u("div",rt)):m.value===""?(a(),u("div",ct,[t("label",dt,[N(t("input",{type:"radio","onUpdate:modelValue":s[8]||(s[8]=_=>m.value=_),value:"last"},null,512),[[q,m.value]]),ut]),t("label",_t,[N(t("input",{type:"radio","onUpdate:modelValue":s[9]||(s[9]=_=>m.value=_),value:"auto"},null,512),[[q,m.value]]),ht]),t("label",pt,[N(t("input",{type:"radio","onUpdate:modelValue":s[10]||(s[10]=_=>m.value=_),value:"custom"},null,512),[[q,m.value]]),vt])])):R("",!0)])}}}),yt={id:"chat_view",class:"common-layout"},mt={key:0},gt={key:1},wt={key:0,style:{height:"calc(100vh)",width:"100%"}},xt={key:1,style:{width:"100%",height:"100%"}},Ut=H({__name:"ChatView",setup(y){const f=n({account:"",describe:"",headImgUrl:"",nickname:"",remark:"",username:"",chat_count:0}),c=p=>{f.value=p},l=n(!1),h=p=>{l.value=p};return(p,w)=>{const i=U("el-aside"),x=U("el-container");return a(),u("div",yt,[l.value?(a(),u("div",gt,[o(x,null,{default:M(()=>[o(i,{width:"auto",style:{"overflow-y":"auto",height:"calc(100vh)"}},{default:M(()=>[o(ee,{onUserData:c})]),_:1}),f.value.username!=""?(a(),u("div",wt,[o(Re,{userData:f.value},null,8,["userData"])])):(a(),u("div",xt,[o(he)]))]),_:1})])):(a(),u("div",mt,[o(ft,{onIsAutoShow:h})]))])}}});export{Ut as default};
