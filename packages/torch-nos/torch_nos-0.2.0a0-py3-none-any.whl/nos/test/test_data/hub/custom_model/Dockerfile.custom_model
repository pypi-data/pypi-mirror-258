
# >>>>>>>>>>>>>>>>>>>>>>>>>>>
# Auto-generated by agi-pack (version=0.1.19).
FROM autonomi/nos:latest-gpu AS animatediff

# Install additional system packages
RUN --mount=type=cache,target=/var/cache/apt \
    apt-get -y update \
    && apt-get -y --no-install-recommends install \
    wget \
    && echo "system install complete"

# Install pip packages, with cache mounting ${PIP_CACHE_DIR} for faster builds
# Note: Cache mounts allow us to re-use the cache for pip packages
# instead of having to re-download them every time we build.
RUN --mount=type=cache,target=${PIP_CACHE_DIR} \
    pip install --cache-dir ${PIP_CACHE_DIR} \
    "einops==0.6.1" \
    "omegaconf==2.3.0" \
    "safetensors==0.3.1" \
    "diffusers==0.11.1" \
    "imageio" \
    "omegaconf" \
    "xformers" \
    && echo "pip install complete"

# Setup working directory
WORKDIR /app/serve/custom_model

# Add project files
ADD ./scripts/entrypoint.sh /app/entrypoint.sh
ADD ./ /app/serve/custom_model

ADD /AnimateDiff /AnimateDiff

# Setup environment variables
ENV PYTHONPATH=$PYTHONPATH:/app/serve
ENV NOS_HUB_CATALOG_PATH=$NOS_HUB_CATALOG_PATH:/app/serve/custom_model/config.yaml
