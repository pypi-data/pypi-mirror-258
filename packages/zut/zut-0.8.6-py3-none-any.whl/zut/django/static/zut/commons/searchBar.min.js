import{fromHTML}from"./index.min.js";import{gettext}from"./i18n.min.js";function delayInputAction(i,{button:r,wait:n}={}){const a=r?r.innerHTML:null;void 0===n&&(n=1);let s=null,l=!1;return function(t){s=t.target.value,l||async function t(){l=!0,r&&(r.innerHTML='<span class="spinner-border spinner-border-sm" aria-hidden="true"></span><span class="visually-hidden" role="status">Loading...</span>',r.disabled=!0),await new Promise(t=>setTimeout(t,1e3*n));var e=s;s=null,await i(e),s&&await t(),r&&(r.innerHTML=a,r.disabled=!1),l=!1}()}}function defaultFormatter(i,r){if(i.section)return`<li class="section">${i.section}</li>`;{let t=i.text,e=(i.url&&(t=`<a href="${i.url}">${t}</a>`),i.prefix&&(t=""+i.prefix+t),i.suffix&&(t=""+t+i.suffix),"");return i.external_url&&(e="result-with-external",t=`<div class="main">${t}</div><div class="external"><a href="${i.external_url}" target="_blank" class="btn btn-sm btn-dark"><i class="bi bi-box-arrow-up-right"></i></a></div>`),`<li class="result ${e}" tabindex="${r+1}">${t}</li>`}}function initSearchBar(o,{formatter:d}={}){d=d||defaultFormatter;var t=o.form.querySelector("button");o.form.style.position="relative";const u=document.createElement("div");function c(t){u.innerHTML=`<div class="text-danger">${t}</div>`,u.style.visibility="visible"}u.classList.add("searchbar-results"),o.form.dataset.resultsWidth&&(u.style.width=o.form.dataset.resultsWidth),o.form.appendChild(u),o.form.addEventListener("input",delayInputAction(async function(t){u.innerHTML="",u.style.visibility="hidden";try{var e=o.form.action+"?"+new URLSearchParams({search:t}),i=await fetch(e,{method:o.form.method});if(i.ok){var r=await i.json(),n=r.rows;if(n&&0!=n.length){var a,s,l=document.createElement("ul");u.appendChild(l),u.style.visibility="visible";for([a,s]of n.entries()){let t=d(s,a);"string"==typeof t&&(t=fromHTML(t)),l.appendChild(t)}r.more&&l.appendChild(fromHTML(`<li class="more">${gettext("There are more results")} ...</li>`))}}else c(i.status+" "+i.statusText)}catch(t){c(t)}},{button:t})),document.addEventListener("mouseup",function(t){t.target==u||u.contains(t.target)||t.target==o||o.contains(t.target)||(u.style.visibility="hidden")}),o.form.addEventListener("mouseover",function(t){u.style.visibility=u.innerHTML?"visible":"hidden"}),o.form.addEventListener("submit",t=>{t.preventDefault();for(const e of u.querySelectorAll("li.result a"))e.target||(window.location=e.href)})}export{initSearchBar};
//# sourceMappingURL=searchBar.min.js.map