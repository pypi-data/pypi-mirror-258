import{formatters}from"./index.min.js";import{BASE_WEBSOCKET_URL,startWebsocket}from"./websockets.min.js";function calculateDuration(t,a){if(!t||"null"==t)return null;"function"!=typeof t.getMonth&&(t=new Date(t)),a&&"null"!=a?"function"!=typeof a.getMonth&&(a=new Date(a)):a=new Date;var a=a-t,t=a<0?"-":"",a=Math.round(Math.abs(a/1e3)),e=Math.floor(a/60),a=a-60*e,r=Math.floor(e/60),e=e-60*r,s=Math.floor(r/24),r=r-24*s;return t+(0<s?s+"j&nbsp;":"")+(r<10?"0":"")+r+`:${e<10?"0":""}${e}:`+(a<10?"0":"")+a}const taskFormatters={shortId:function(t){return t&&`<a href="${window.location.pathname.replace(/\/$/,"")}/${t}/" title="${t}">${t.substring(0,8)}â€¦</a>`},state:function(t){let a="secondary";switch(t){case"STARTED":a="primary";break;case"PROGRESS":a="info";break;case"FAILURE":a="danger";break;case"SUCCESS":a="success";break;case"RETRY":case"ISSUE":a="warning"}return`<span class="text-${a}">${t}</span>`},progress:function(t,a){return t?(t=parseInt(t),`<div class="progress"><div class="progress-bar${"PROGRESS"==a.state?" progress-bar-striped progress-bar-animated":""}" role="progressbar" aria-valuenow="${t}%" aria-valuemin="0" aria-valuemax="100" style="width: ${t}%">${t}%</div></div>`):null},duration:function(t,a){return`<span class='task-duration' data-task-id="${a.id}">${calculateDuration(a.start,a.end)??"-"}</span>`}};function startTaskDetailWebsocket(t){var a=t.dataset.taskId;const e=t.querySelector('[data-field="id"]'),r=t.querySelector('[data-field="name"]'),s=t.querySelector('[data-field="params"]'),n=t.querySelector('[data-field="worker"]'),o=t.querySelector('[data-field="state"]'),i=t.querySelector('[data-field="progress"]'),l=t.querySelector('[data-field="details"]'),d=t.querySelector('[data-field="start"]'),u=t.querySelector('[data-field="end"]'),c=t.querySelector('[data-field="duration"]');t=window.location.pathname.startsWith("/task/")?"/ws/task":"/zut/ws/task";startWebsocket(BASE_WEBSOCKET_URL+t+`/${a}/`,{onMessage:function(t){e&&(e.innerHTML=t.task.id??"-"),r&&(r.innerHTML=t.task.name??"-"),s&&(s.innerHTML=t.task.params??"-"),n&&(n.innerHTML=t.task.worker??"-"),o&&(o.innerHTML=taskFormatters.state(t.task.state)??"-"),i&&(i.innerHTML=taskFormatters.progress(t.task.progress,{state:t.task.state})??"-"),l&&(l.innerHTML=t.task.details??"-"),d&&(d.dataset.value=t.task.start,d.innerHTML=formatters.date(t.task.start)??"-"),u&&(u.dataset.value=t.task.end,u.innerHTML=formatters.date(t.task.end)??"-"),c&&(c.innerHTML=taskFormatters.duration(null,{start:t.task.start,end:t.task.end})??"-")},name:"task-"+a}),c&&function t(){setTimeout(()=>{c.innerHTML=calculateDuration(d.dataset.value,u.dataset.value)??"-",t()},900)}()}export{calculateDuration,taskFormatters,startTaskDetailWebsocket};
//# sourceMappingURL=celery.min.js.map