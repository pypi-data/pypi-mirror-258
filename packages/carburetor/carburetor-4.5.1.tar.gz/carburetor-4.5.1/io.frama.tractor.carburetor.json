{
  "app-id": "io.frama.tractor.carburetor",
  "runtime": "org.gnome.Platform",
  "runtime-version": "45",
  "sdk": "org.gnome.Sdk",
  "command": "carburetor",
  "finish-args": [
    "--share=ipc",
    "--socket=fallback-x11",
    "--socket=wayland",
    "--device=dri",
    "--share=network",
    "--filesystem=xdg-run/dconf",
    "--filesystem=~/.config/dconf:ro",
    "--talk-name=ca.desrt.dconf",
    "--env=DCONF_USER_CONFIG_DIR=.config/dconf",
    "--env=GIO_EXTRA_MODULES=/app/lib/gio/modules/"
  ],
  "cleanup": [
    "*.a",
    "*.la",
    "/etc",
    "/include",
    "/lib/pkgconfig",
    "/libexec",
    "/share/dbus-1"
  ],
  "modules": [
    "data/flatpak/python3-requirements.json",
    {
      "name": "libevent",
      "sources": [
        {
          "type": "archive",
          "url": "https://github.com/libevent/libevent/releases/download/release-2.1.12-stable/libevent-2.1.12-stable.tar.gz",
          "sha256": "92e6de1be9ec176428fd2367677e61ceffc2ee1cb119035037a27d346b0403bb"
        }
      ]
    },
    {
      "name": "tor",
      "config-opts": [
        "--disable-module-relay",
        "--disable-asciidoc",
        "--disable-manpage",
        "--disable-html-manual",
        "--disable-unittests"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://dist.torproject.org/tor-0.4.8.10.tar.gz",
          "sha256": "e628b4fab70edb4727715b23cf2931375a9f7685ac08f2c59ea498a178463a86"
        }
      ]
    },
    {
      "name": "dconf",
      "buildsystem": "meson",
      "config-opts": [
        "-Dbash_completion=false",
        "-Dman=false",
        "-Dgtk_doc=false",
        "-Dsystemduserunitdir=/app/lib/systemd/user"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://download.gnome.org/sources/dconf/0.40/dconf-0.40.0.tar.xz",
          "sha256": "cf7f22a4c9200421d8d3325c5c1b8b93a36843650c9f95d6451e20f0bcb24533"
        },
        {
          "type": "patch",
          "path": "data/flatpak/dconf-override.patch"
        }
      ]
    },
    {
      "name": "tractor",
      "buildsystem": "simple",
      "build-commands": [
        "pip3 install --verbose --exists-action=i --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST} . --no-build-isolation",
        "install -Dm644 src/tractor/tractor.gschema.xml -t ${FLATPAK_DEST}/share/glib-2.0/schemas",
        "glib-compile-schemas ${FLATPAK_DEST}/share/glib-2.0/schemas",
        "cp ${PWD}/src/tractor/SampleBridges ${FLATPAK_DEST}/lib/python$(python -c 'import sys; print(\"%s.%s\" %sys.version_info[0:2])')/site-packages/tractor/"
      ],
      "sources": [
        {
          "type": "git",
          "url": "https://framagit.org/tractor/tractor.git",
          "tag": "4.3.1"
        }
      ]
    },
    {
      "name": "carburetor",
      "buildsystem": "simple",
      "build-commands": [
        "pip3 install --verbose --exists-action=i --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST} . --no-build-isolation",
        "install -Dm644 data/io.frama.tractor.carburetor.desktop -t ${FLATPAK_DEST}/share/applications",
        "install -Dm644 data/metainfo/io.frama.tractor.carburetor.metainfo.xml -t ${FLATPAK_DEST}/share/metainfo",
        "install -Dm644 data/icons/scalable/apps/io.frama.tractor.carburetor.svg -t ${FLATPAK_DEST}/share/icons/hicolor/scalable/apps",
        "install -Dm644 data/icons/symbolic/apps/io.frama.tractor.carburetor-symbolic.svg -t ${FLATPAK_DEST}/share/icons/hicolor/symbolic/apps"
      ],
      "sources": [
        {
          "type": "git",
          "url": ".",
          "branch": "main"
        }
      ]
    }
  ]
}
